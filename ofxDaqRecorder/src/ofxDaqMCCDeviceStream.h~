#ifndef OFXDAQMCCDEVICESTREAM
#define OFXDAQMCCDEVICESTREAM

    #include "ofxDaqStream.h"
    #include "DAQFlex_libusb/mccdevice.h"

    #define FIRSTHALF true
    #define SECONDHALF false

    class ofxDaqMCCDeviceStream : public ofxDaqStream, public ofThread {

        public:

            //ofxDaqMCCDeviceStream();
            //ofxDaqMCCDeviceStream(int blockSize_, int N_);
            //ofxDaqMCCDeviceStream(int blockSize_,int N_,string filePrefix);
            ofxDaqMCCDeviceStream(ofxXmlSettings settings);
            ~ofxDaqMCCDeviceStream();
            bool start(int elapsedTime);
            bool stop();
            bool loadSettings(ofxXmlSettings settings);
            bool writeData();
            bool update(int startTime, bool newFile);
            bool nextFile(int elapsedTime);
            bool dataValid(char  * dataIn,int bufferSize);
            bool dataReady();
            float percentBufferFree();
            float getDataRate();
            void threadedFunction();

            // MCC Device specific functions
            void fillCalConstants(unsigned int lowChan, unsigned int highChan);
            bool initialize();
            
                         

        protected:

            unsigned int blockSize;
            float dataRate;
            float startTime;
            unsigned int dataStartTime;
            unsigned int N;
            char * dataBlock;
            string filePrefix;

            // Specific for DAQFlex
            int deviceType;
            MCCDevice* device;
            dataBuffer* buffer;
            int numChans;
            int numSamples;
            int lowChan;
            int highChan;
            unsigned int sampleRate;
            unsigned int timeout;
            unsigned int bulkTxLength;
            float *calSlope;
            float *calOffset;
            int minVoltage;
            int maxVoltage;
    
            bool deviceError;
            bool initialized;

    };

#endif
